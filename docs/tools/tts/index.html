<!DOCTYPE html>
<html lang="en-ca">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Text-to-Speech</title>
<link rel="shortcut icon" type="image/svg+xml" href="../../media/speaker.svg" />
<script type="text/javascript" src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script type="text/javascript">

let voices = [], cast = [];

function tts() {
    voices = speechSynthesis.getVoices();
    if (voices.length == 0) setTimeout(tts, 100);
    else {
        console.log(voices);
        for (let k in tts.map) {
            let name = tts.map[k];
            tts.map[k] = null;
            for (let i=0;i<voices.length;i++) {
                if (!name) name = k;
                if (voices[i].name.search(name) > -1) tts.map[k] = voices[i];
            }
        }
        let rm = [];
        for (let k in tts.map) if (tts.map[k] == null) rm.push(k);
        for (let i=0;i<rm.length;i++) delete tts.map[rm[i]];
        let i = 0;
        for (let k in tts.map) {
            cast.push(k);
            console.log(`${i} = ${cast[i]}`);
            i++;
        }
    }
    play.stop = false;
}

tts.map = {
// Search voice names for these Microsoft and Google voices...
    "Zira": 0,
    "Mark": 0,
    "Hazel": 0,
    "David": 0,
    "Richard": 0,
    "Linda": 0,
    "Liz": "UK English Female",
    "Phil": "UK English Male",
    "Amy": "US English",
    "Ned": "Nederlands",
    "Marie": "franÃ§ais",
}

tts.find = (male, female) => {
    let m = [], f = [];
    for (let v of male) {
        let i = cast.indexOf(v);
        if (i > -1) m.push(i);
    }
    for (let v of female) {
        let i = cast.indexOf(v);
        if (i > -1) f.push(i);
    }
    return [m, f];
}

function say(text, v) {
    let u = new SpeechSynthesisUtterance(text);
    let opt;
    Object.assign(u, {rate: 1, lang: "en-CA"});
    if (v != null) {
        if (typeof(v) != "number") [v, opt] = v;
        say.voice = cast[v];
        Object.assign(u, {voice: tts.map[say.voice]});
    }
    u.onend = () => {console.log(u)}
    if (opt) Object.assign(u, opt);
    speechSynthesis.speak(u);
    console.log(`${say.voice}: ${text}`);
}

say.queue = [];

function queue(text, v, delay) {say.queue.push([text, v, delay])}

function play(restart) {
    if (restart) play.stop = false;
    else if (play.stop) {
        say.queue = [];
        play.stop = false;
        console.log("Stopped!");
        return;
    }
    let u = say.queue[0];
    let v = u[1], vopt;
    if (typeof(v) != "number") [v, vopt] = v;
    say.queue.splice(0, 1);
    let opt = {onend: () => {
        if (say.queue.length) setTimeout(play, 1000 * say.queue[0][2]);
        else console.log("Done!");
    }};
    if (vopt) Object.assign(opt, vopt);
    say(u[0], [v, opt]);
}

function stop() {play.stop = true}

tts();

console.log(`Usage...

$.getScript("example.js");
queue("Hello", castNumber, delayBefore);
play(true);
stop();`);

</script>
</head>
<body>See Developer Console...</body>
</html>