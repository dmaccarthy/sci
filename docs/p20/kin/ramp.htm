<!-- © 2023-2025 by D.G. MacCarthy <sc8pr.py@gmail.com> -->

<style type="text/css">

#RampAngle {width: 4em}

#SimControls img {
    cursor: pointer;
    vertical-align:middle;
    width: 24px;
    height: 24px;
}

#SimControls svg * {
    fill: none;
    stroke-width: 12;
    stroke: #0065fe
}

#SimControls svg.Disabled * {stroke: lightgrey}

</style>

<section class="Post" data-icon="simulation">
<h2 class="Collapse">Simulation</h2>

<div class="Collapse Expand Center">

<p><svg id="Sim" onclick="loadFeed.sim.click()"></svg></p>
<p id="SimControls">
    <select title="Choose object type" onchange="loadFeed.sim.init()" id="BallType">
        <option>Hollow Sphere</option>
        <option>Solid Sphere</option>
        <option>Solid Cylinder</option>
        <option>Ring</option>
    </select> &nbsp;
    <input type="number" title="Set ramp angle" onchange="loadFeed.sim.init()" id="RampAngle" value="30" min="0" max="90" step="5" /> &nbsp;
    <!-- <img src="media/arrow_cw.svg" alt="Backward" onclick="loadFeed.sim.step(-1)" style="transform: scaleX(-1)"></img> &nbsp;
    <img src="media/arrow_cw.svg" alt="Forward" onclick="loadFeed.sim.step(1)"></img> -->
</p>

</div></section>

<section class="Post" data-icon="help">
<h2 class="Collapse">Help</h2>
<div class="Collapse">
    <p>Click on the animation to play, pause, and reset. The markings on the ramp are in centimetres and the object is initially centred at 0 cm.</p>
    <p>Use the controls below the animation to...</p>
    <ul>
        <li>Select the object type: hollow sphere (basketball), solid sphere (billiard ball), solid cylinder, or ring.</li>
        <li>Set the ramp angle in degrees from 0 to 90.</li>
        <!-- <li>Adjust the animation one frame (1/60<sup>th</sup> of a second) back or forward. These buttons will be deactivated when the animation is finished. For freefall (ramp angle set to 90), the back button will be deactivated when the ball bounces.</li> -->
    </ul>
    <p>The animation timer stops when the object reaches the photogate, at which point its displacement is 2.00 metres.</p>
    <!-- <p>When the object passes the “photogate” (mounted at the 200 cm mark) the instantaneous velocity and the time at which the velocity was measured will appear below the timer in red.</p> -->
</div></section>

<script type="text/javascript" data-init="sim">

loadFeed.sim = () => {
    let svg = new SVG2("#Sim", {scale: 256, lrbt: [-2.2, 0.3, -0.2, 2.14]}).css(".NoStyle");
    let [w, h] = svg.size;
    svg.image("p20/kin/img/class.svg", [1, 1]).then(i => i.attr({x:0, y:0, width:w, height: h}));

    let ramp = svg.ramp = svg.group();
    let gate = svg.gate = ramp.group("black@1");
    let balls = svg.balls = ramp.group().config({animated: true, shift: [-2, 0]});

    // Draw ramp
    ramp.ruler(60, 0.05, {width: 0.16, big: 5, tickSmall: 0.21, tickBig: 0.42}).css({fill: "lightgrey", "fill-opacity": 0.8}, "#0065fe@1").config({pivot: [-1, -0.08], shift: [1, 0.08], theta: 180});
    let g = ramp.group("text", "#0065fe", 16);
    for (let x = -225; x < 55; x += 25) g.text(Math.abs(200 + x), [x / 100, -0.13]);

    // Draw timer
    svg.timer = svg.gtext("0.000 s", ["text", 36, {"font-family": SVG2.mono}]);

    // Draw photogate
    gate.rect([0.08, 0.14]).css({fill: "lightgrey"});
    gate.circle("4", [0, 0.03]).css({fill: "#0065fe"});

    // Draw objects
    let b = [];
    for (let i=0;i<4;i++) {
        let ball = loadFeed.sim.ballInfo[i];
        let r = ball[0];
        ball = balls.group().config({shift: [0, r]});
        b.push(ball);
        if (i == 0) ball.image("media/ball.svg", [2 * r, 2 * r]);
        else if (i == 1) {
            let c8 = [-r/10, r/10];
            ball.config("text", "black").circle(r);
            ball.circle(0.5 * r, c8).css({fill: "white"});
            ball.gtext("8", [12], c8);
        }
        else {
            let v = vec2d(r - 0.01, uniform(0, 360));
            if (i == 2) {
                v = v.times(0.7);
                ball.circle(r).css({fill: "#2020a0", stroke: "black"});
                ball.line(v, v.neg()).css({stroke: "white", "stroke-width": "3px"});
            }
            else {
                ball.circle(r - 0.01).css({fill: "none", stroke: "#2020a0", "stroke-width": "5px"});
                ball.circle("3", v).css({fill: "#ffc0c0"});
            }
        }
    }

    svg.beforeupdate = function() {
        this.timeFactor = 1;
        let t = this.time;
        let i = svg.ballType;
        let info = loadFeed.sim.ballInfo[i];
        let r = info[0];
        let balls = this.balls; 
        let ball = balls.$.children("g")[i].graphic;
        let vertical = balls.acc[0] == 9.81;
        let d = balls.shift[0];
        let d0 = 0.205 - r;
        let done = false;
        if (vertical) {
            if (d > d0) {
                balls.config({shift: [d0, 0], vel: [-balls.vel[0] * balls.elas, 0]});
                done = balls.vel[0] > -0.2;
            }
        } else {
            ball.config({theta: -d / r * RAD});
            done = d > 0.45;
        }
        if (done) this.pause().config({done: true});
        this.timer.$.find("text").html(`${Math.min(t, balls.tmax).toFixed(3)} s`);
    }

    loadFeed.sim.svg = svg;
    loadFeed.sim.init();
    // console.log(svg);
}

// Object size, moment of inertia, elasticity
loadFeed.sim.ballInfo = [
    [0.14, 1/3, 0.4, 0.6],    // Basketball
    [0.06, 0.2, 0.1, 0.2],    // 8-Ball
    [0.08, 0.25, 0.15, 0.3],  // Cylinder
    [0.12, 0.5, 0.3, 0.5]     // Ring
];

loadFeed.sim.init = () => {
    e = $("#RampAngle");
    let a = Math.min(90, Math.max(1, e.val()));
    e.val(a);
    let svg = loadFeed.sim.svg.pause().config({time: 0});
    svg.ramp.config({theta: -a});
    svg.timer.config({shift: [a < 62 ? -0.2 : -1.7, 1.8]});
    let i = svg.ballType = $("#BallType")[0].selectedIndex;
    let info = loadFeed.sim.ballInfo[i];
    svg.gate.config({shift: [info[0], 0.07]});
    let acc = 9.81 * (a == 90 ? 1 : sin(a) / (1 + 2 * info[1]));
    let elas = Math.sqrt(uniform(info[2], info[3]));
    let tmax = 2 / Math.sqrt(acc);
    let balls = svg.balls.config({elas: elas, tmax: tmax, shift: [-2, 0], vel: [0, 0], acc: [acc, 0]});
    $(balls.$.children().hide()[i]).show();
    svg.config({done: false}).update(0);
}

loadFeed.sim.click = () => {
    let svg = loadFeed.sim.svg;
    if (svg.done) loadFeed.sim.init();
    else svg.toggle();
}

loadFeed.data = {
    title: "Motion Along a Ramp",
    up: "p20/kin/graph",
}

</script>
